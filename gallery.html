<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Trust Nest Fundrasing Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxuvwv/b4jzlGC62Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            color-scheme: light;
            --accent: #34b3d3;
            --accent-strong: #0284c7;
            --accent-dark: #1e3a8a;
            --accent-soft: rgba(2, 132, 199, 0.12);
            --card-bg: #f0f9ff;
            --card-border: rgba(2, 132, 199, 0.2);
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            background: linear-gradient(125deg, #e0f2fe 0%, #bae6fd 45%, #ffffff 100%);
            color: #083344;
        }

        .glass-card {
            background: rgba(240, 249, 255, 0.94);
            backdrop-filter: blur(22px);
            border: 1px solid var(--card-border);
            box-shadow: 0 28px 55px -28px rgba(2, 132, 199, 0.35);
        }

        .dashboard-backdrop {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .dashboard-backdrop div {
            position: absolute;
            border-radius: 9999px;
            filter: blur(120px);
            opacity: 0.65;
        }

        .dashboard-backdrop div:nth-child(1) {
            width: 540px;
            height: 540px;
            background: rgba(2, 132, 199, 0.32);
            top: -120px;
            left: -140px;
        }

        .dashboard-backdrop div:nth-child(2) {
            width: 480px;
            height: 480px;
            background: rgba(125, 211, 252, 0.28);
            bottom: -160px;
            right: -120px;
        }

        .dashboard-backdrop div:nth-child(3) {
            width: 380px;
            height: 380px;
            background: rgba(147, 197, 253, 0.24);
            top: 38%;
            right: 28%;
        }

        .bg-blue-500 {
            background-color: var(--accent) !important;
        }

        .hover\:bg-blue-600:hover {
            background-color: var(--accent-dark) !important;
        }

        .bg-blue-50 {
            background-color: var(--accent-soft) !important;
        }

        .text-blue-600 {
            color: var(--accent-strong) !important;
        }

        .text-blue-700 {
            color: var(--accent-dark) !important;
        }

        .border-blue-200 {
            border-color: rgba(2, 132, 199, 0.42) !important;
        }

        .border-blue-200\/60 {
            border-color: rgba(2, 132, 199, 0.28) !important;
        }

        .border-blue-100\/60 {
            border-color: rgba(2, 132, 199, 0.18) !important;
        }

        .ring-blue-200 {
            --tw-ring-color: rgba(2, 132, 199, 0.28) !important;
        }

        .ring-blue-100 {
            --tw-ring-color: rgba(2, 132, 199, 0.18) !important;
        }

        .shadow-blue-500\/40 {
            box-shadow: 0 18px 48px rgba(2, 132, 199, 0.32) !important;
        }

        .shadow-blue-500\/30 {
            box-shadow: 0 18px 42px rgba(2, 132, 199, 0.24) !important;
        }

        .shadow-blue-500\/20 {
            box-shadow: 0 12px 28px rgba(2, 132, 199, 0.18) !important;
        }

        .hover\:bg-blue-50:hover {
            background-color: rgba(2, 132, 199, 0.12) !important;
        }
    </style>
</head>
<body class="relative text-slate-700">
    <div class="dashboard-backdrop" aria-hidden="true">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="relative z-10">
        <nav class="max-w-6xl mx-auto px-6 pt-8">
            <div class="glass-card rounded-3xl px-6 py-5 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                <a href="index.html" class="flex items-center gap-3">
                    <span class="inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-blue-500 text-white text-lg font-semibold tracking-tight shadow-lg shadow-blue-500/40">TN</span>
                    <div>
                        <p class="text-xs uppercase tracking-[0.35em] text-blue-700">Trust Nest</p>
                        <p class="text-base font-semibold text-slate-900">Fundrasing Gallery</p>
                    </div>
                </a>
                <div class="flex flex-wrap items-center gap-3 text-sm">
                    <span id="userInfo" class="rounded-full bg-blue-50 px-3 py-1 text-blue-700 border border-blue-200/60"></span>
                    <button id="logoutBtn" onclick="    logout()" class="rounded-full border border-red-200 px-3 py-1 text-red-600 transition hover:bg-red-50"><i class="fas fa-sign-out-alt mr-1"></i>Logout</button>
                    <a href="donor_page.html" class="rounded-full bg-blue-500 px-4 py-2 text-white transition hover:bg-blue-600 shadow-lg shadow-blue-500/20"><i class="fas fa-concierge-bell mr-1"></i>Donors Landing Page</a>
                    <a href="fundraiser_page.html" class="rounded-full bg-blue-500 px-4 py-2 text-white transition hover:bg-blue-600 shadow-lg shadow-blue-500/20"><i class="fas fa-concierge-bell mr-1"></i>Fundraisers Landing Page</a>
                </div>
            </div>
        </nav>
        <main class="max-w-6xl mx-auto px-6 mt-16 pb-20">
            <div class="glass-card rounded-3xl p-6 md:p-8 space-y-8">
                <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
                    <div>
                        <h2 class="text-3xl font-semibold text-slate-900">Fundrasing Gallery</h2>
                        <p class="text-sm text-slate-500">...</p>
                    </div>
                    <p class="text-xs uppercase tracking-[0.4em] text-blue-600">...</p>
                </div>
                <div id="productsList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
            </div>
        </main>
    </div>
    <script>
        const API_BASE = "https://hiiennggithubio-production.up.railway.app";
        const translations = {
            en: {
                loading: 'Loading...',
                noProducts: 'No products available.',
                serverError: 'Cannot connect to server.',
                errorAlert: 'An error occurred',
            }
        };

        function getToken() {
            return localStorage.getItem("access_token") || '';
        }

        function getEmail() {
            return localStorage.getItem("user_email") || '';
        }

        function logout() {
            localStorage.clear();
            location.href = 'index.html';
        }

        async function loadProducts() {
            const wrap = document.getElementById("productsList");
            if (!wrap) return;
            const t = translations.en;
            wrap.innerHTML = `<p class='rounded-3xl border border-dashed border-blue-200 bg-white/60 px-4 py-6 text-center text-sm text-blue-600'>${t.loading}</p>`;
            try {
                const res = await fetch(`${API_BASE}/products`, {
                    headers: { "Authorization": `Bearer ${getToken()}` }
                });
                const products = await res.json();
                if (!res.ok) {
                    wrap.innerHTML = `<p class='rounded-2xl border border-red-200 bg-white/70 px-4 py-5 text-center text-sm text-red-600'>${products.detail || t.errorAlert}</p>`;
                    return;
                }
                if (!Array.isArray(products) || !products.length) {
                    wrap.innerHTML = `<p class='rounded-2xl border border-slate-200 bg-white/70 px-4 py-6 text-center text-sm text-slate-400'>${t.noProducts}</p>`;
                    return;
                }

                const productIds = products.map(p => p.product_id);
                const imagesRes = await fetch(`${API_BASE}/images?product_ids=${productIds.join(',')}`, {
                    headers: { "Authorization": `Bearer ${getToken()}` }
                });
                const images = await imagesRes.json();
                const imageMap = {};
                if (imagesRes.ok) {
                    images.forEach(img => {
                        if (!imageMap[img.product_id]) imageMap[img.product_id] = [];
                        imageMap[img.product_id].push(img);
                    });
                }

                wrap.innerHTML = products.map(p => {
                    const imgSrc = imageMap[p.product_id]?.[0]?.url || 'https://images.unsplash.com/photo-1505691723518-36a5ac3be353?auto=format&fit=crop&w=900&q=70';
                    const priceValue = Number.isFinite(Number(p.price)) ? Number(p.price) : null;
                    const priceLabel = priceValue !== null ? priceValue.toLocaleString('en-US') + ' VND' : '-';
                    const quantityLabel = p.quantity_type ? ' ' + p.quantity_type : '';
                    const start = p.price_start_date ?? '-';
                    const description = p.description ?? '';
                    const title = p.main_type + (p.sub_type ? ' - ' + p.sub_type : '');
                    return `
                        <article class="group relative overflow-hidden rounded-3xl border border-blue-100/60 bg-white/85 shadow-lg shadow-blue-500/10 flex flex-col">
                            <div class="relative h-48 overflow-hidden">
                                <img src="${imgSrc}" alt="${title}" class="h-full w-full object-cover transition duration-500 group-hover:scale-105" loading="lazy"/>
                                <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/65 to-transparent px-5 pb-4 pt-12 text-white">
                                    <h4 class="text-lg font-semibold">${title}</h4>
                                </div>
                            </div>
                            <div class="flex flex-1 flex-col gap-2 px-5 py-4 text-sm text-slate-600">
                                <p class="text-base font-semibold text-blue-600">${priceLabel}${quantityLabel}</p>
                                <p class="text-xs uppercase tracking-wide text-slate-400">Effective from: ${start}</p>
                                <p class="text-sm text-slate-600">${description}</p>
                            </div>
                        </article>`;
                }).join("");
            } catch (error) {
                console.error('Error loading products:', error);
                wrap.innerHTML = `<p class='rounded-2xl border border-red-200 bg-white/70 px-4 py-5 text-center text-sm text-red-600'>${t.serverError}</p>`;
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const userInfo = document.getElementById("userInfo");
            if (userInfo) {
                userInfo.textContent = getEmail();
            }
            loadProducts();
        });
    </script>
</body>
</html>