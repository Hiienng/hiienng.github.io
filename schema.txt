CREATE TABLE products (
  product_id SERIAL PRIMARY KEY,       -- ID tự tăng
  main_type VARCHAR(100) NOT NULL,     -- loại chính (vd: Nhà, Đất, Villa...)
  sub_type VARCHAR(100),               -- loại phụ (vd: Biệt thự, Căn hộ 2PN...)
  price NUMERIC(15,2),                 -- giá (có thể để dạng số với 2 chữ số thập phân)
  price_start_date DATE,               -- ngày bắt đầu áp dụng giá
  description TEXT,                    -- mô tả chi tiết
  quantity_type VARCHAR(50),           -- đơn vị (vd: /đêm, /m2, /tháng...)
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  created_by VARCHAR(100)              -- email người tạo / admin
);
CREATE TABLE images (
  id SERIAL PRIMARY KEY,
  product_id INT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  main_group TEXT,            
  sub_group TEXT,
  url TEXT NOT NULL,
  filename TEXT,
  sort_index INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT now()
)
  CREATE TABLE booking_events ( 
  event_id SERIAL PRIMARY KEY, 
  booking_id INTEGER NOT NULL REFERENCES bookings(booking_id) ON DELETE CASCADE, 
  event_type VARCHAR(20) NOT NULL, -- BOOKED|WAITING|PAID|CANCELED|EXPIRED ... 
  note TEXT, 
  meta JSONB, 
  created_at TIMESTAMP NOT NULL DEFAULT NOW(), 
  created_by VARCHAR(100) -- email user/admin 
  );
  
CREATE TABLE payments ( 
  payment_id SERIAL PRIMARY KEY, 
  booking_id INTEGER NOT NULL REFERENCES bookings(booking_id) ON DELETE CASCADE, 
  provider VARCHAR(50),
  external_id VARCHAR(100),
  status VARCHAR(20) NOT NULL, 
  amount NUMERIC(12,2) NOT NULL, 
  currency VARCHAR(3) DEFAULT 'VND', 
  paid_at TIMESTAMP,
  raw_response JSONB,
  created_at TIMESTAMP NOT NULL DEFAULT NOW() 
)
;

CREATE TABLE bookings (
    booking_id SERIAL PRIMARY KEY,
    email VARCHAR(50) NOT NULL,
    start_date timestamp,
    end_date timestamp,
    no_visitors INTEGER,
    payment_flag BOOLEAN NOT NULL DEFAULT false,
    no_day integer,
    payment_value NUMERIC(12,2),
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);